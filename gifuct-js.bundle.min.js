!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).GIFuct={})}(this,function(e){"use strict";function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,n={},i={};function o(){if(t)return i;t=1,Object.defineProperty(i,"__esModule",{value:!0}),i.loop=i.conditional=i.parse=void 0;i.parse=function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(t))t.forEach(function(t){return e(r,t,n,i)});else if("function"==typeof t)t(r,n,i,e);else{var o=Object.keys(t)[0];Array.isArray(t[o])?(i[o]={},e(r,t[o],n,i[o])):i[o]=t[o](r,n,i,e)}return n};i.conditional=function(e,r){return function(t,n,i,o){r(t,n,i)&&o(t,e,n,i)}};return i.loop=function(e,r){return function(t,n,i,o){for(var a=[],d=t.pos;r(t,n,i);){var s={};if(o(t,e,n,s),t.pos===d)break;d=t.pos,a.push(s)}return a}},i}var a,d,s={};function c(){if(a)return s;a=1,Object.defineProperty(s,"__esModule",{value:!0}),s.readBits=s.readArray=s.readUnsigned=s.readString=s.peekBytes=s.readBytes=s.peekByte=s.readByte=s.buildStream=void 0;s.buildStream=function(e){return{data:e,pos:0}};var e=function(){return function(e){return e.data[e.pos++]}};s.readByte=e;s.peekByte=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(r){return r.data[r.pos+e]}};var r=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};s.readBytes=r;s.peekBytes=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};s.readString=function(e){return function(t){return Array.from(r(e)(t)).map(function(e){return String.fromCharCode(e)}).join("")}};s.readUnsigned=function(e){return function(t){var n=r(2)(t);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};s.readArray=function(e,t){return function(n,i,o){for(var a="function"==typeof t?t(n,i,o):t,d=r(e),s=new Array(a),c=0;c<a;c++)s[c]=d(n);return s}};return s.readBits=function(e){return function(r){for(var t=function(e){return e.data[e.pos++]}(r),n=new Array(8),i=0;i<8;i++)n[7-i]=!!(t&1<<i);return Object.keys(e).reduce(function(r,t){var i=e[t];return i.length?r[t]=function(e,r,t){for(var n=0,i=0;i<t;i++)n+=e[r+i]&&Math.pow(2,t-i-1);return n}(n,i.index,i.length):r[t]=n[i.index],r},{})}},s}var u=r((d||(d=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o(),t=c(),n={blocks:function(e){for(var r=[],n=e.data.length,i=0,o=(0,t.readByte)()(e);0!==o&&o;o=(0,t.readByte)()(e)){if(e.pos+o>=n){var a=n-e.pos;r.push((0,t.readBytes)(a)(e)),i+=a;break}r.push((0,t.readBytes)(o)(e)),i+=o}for(var d=new Uint8Array(i),s=0,c=0;c<r.length;c++)d.set(r[c],s),s+=r[c].length;return d}},i=(0,r.conditional)({gce:[{codes:(0,t.readBytes)(2)},{byteSize:(0,t.readByte)()},{extras:(0,t.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,t.readUnsigned)(!0)},{transparentColorIndex:(0,t.readByte)()},{terminator:(0,t.readByte)()}]},function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&249===r[1]}),a=(0,r.conditional)({image:[{code:(0,t.readByte)()},{descriptor:[{left:(0,t.readUnsigned)(!0)},{top:(0,t.readUnsigned)(!0)},{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{lct:(0,t.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,t.readArray)(3,function(e,r,t){return Math.pow(2,t.descriptor.lct.size+1)})},function(e,r,t){return t.descriptor.lct.exists}),{data:[{minCodeSize:(0,t.readByte)()},n]}]},function(e){return 44===(0,t.peekByte)()(e)}),d=(0,r.conditional)({text:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{preData:function(e,r,n){return(0,t.readBytes)(n.text.blockSize)(e)}},n]},function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&1===r[1]}),s=(0,r.conditional)({application:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{id:function(e,r,n){return(0,t.readString)(n.blockSize)(e)}},n]},function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&255===r[1]}),u=(0,r.conditional)({comment:[{codes:(0,t.readBytes)(2)},n]},function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&254===r[1]}),f=[{header:[{signature:(0,t.readString)(3)},{version:(0,t.readString)(3)}]},{lsd:[{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{gct:(0,t.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,t.readByte)()},{pixelAspectRatio:(0,t.readByte)()}]},(0,r.conditional)({gct:(0,t.readArray)(3,function(e,r){return Math.pow(2,r.lsd.gct.size+1)})},function(e,r){return r.lsd.gct.exists}),{frames:(0,r.loop)([i,s,u,a,d],function(e){var r=(0,t.peekByte)()(e);return 33===r||44===r})}];e.default=f}(n)),n)),f=o(),l=c();const p=(e,r,t)=>{if(!e.image)return void console.warn("gif frame does not have associated image.");const{image:n}=e,i=n.descriptor.width*n.descriptor.height;var o=((e,r,t)=>{const n=4096,i=t;var o,a,d,s,c,u,f,l,p,y;const g=new Array(t),h=new Array(n),v=new Array(n),x=new Array(4097);for(c=1+(a=1<<(y=e)),o=a+2,f=-1,d=(1<<(s=y+1))-1,l=0;l<a;l++)h[l]=0,v[l]=l;var B,m,b,k,w,A;for(B=m=b=k=w=A=0,p=0;p<i;){if(0===k){if(m<s){B+=r[A]<<m,m+=8,A++;continue}if(l=B&d,B>>=s,m-=s,l>o||l==c)break;if(l==a){d=(1<<(s=y+1))-1,o=a+2,f=-1;continue}if(-1==f){x[k++]=v[l],f=l,b=l;continue}for(u=l,l==o&&(x[k++]=b,l=f);l>a;)x[k++]=v[l],l=h[l];b=255&v[l],x[k++]=b,o<n&&(h[o]=f,v[o]=b,0===(++o&d)&&o<n&&(s++,d+=o)),f=u}k--,g[w++]=x[k],p++}for(p=w;p<i;p++)g[p]=0;return g})(n.data.minCodeSize,n.data.blocks,i);n.descriptor.lct.interlaced&&(o=((e,r)=>{const t=new Array(e.length),n=e.length/r,i=function(n,i){const o=e.slice(i*r,(i+1)*r);t.splice.apply(t,[n*r,r].concat(o))},o=[0,4,2,1],a=[8,8,4,2];for(var d=0,s=0;s<4;s++)for(var c=o[s];c<n;c+=a[s])i(c,d),d++;return t})(o,n.descriptor.width));const a={pixels:o,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?a.colorTable=n.lct:a.colorTable=r,e.gce&&(a.delay=10*(e.gce.delay||10),a.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(a.transparentIndex=e.gce.transparentColorIndex)),t&&(a.patch=(e=>{const r=e.pixels.length,t=new Uint8ClampedArray(4*r);for(var n=0;n<r;n++){const r=4*n,i=e.pixels[n],o=e.colorTable[i]||[0,0,0];t[r]=o[0],t[r+1]=o[1],t[r+2]=o[2],t[r+3]=i!==e.transparentIndex?255:0}return t})(a)),a};e.decompressFrame=p,e.decompressFrames=(e,r)=>e.frames.filter(e=>e.image).map(t=>p(t,e.gct,r)),e.parseGIF=e=>{const r=new Uint8Array(e);return f.parse(l.buildStream(r),u)}});
